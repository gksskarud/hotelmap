<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>í˜¸í…” + ê´€ê´‘ì§€ + ì¹´í˜ + ìŒì‹ì  ê²€ìƒ‰ ì§€ë„</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <style>
    body { font-family: "Pretendard", sans-serif; margin: 0; padding: 0; text-align: center; }
    #map { height: 85vh; width: 100%; }
    #controls { padding: 10px; background: #f0f0f0; }
    input, select, button { margin: 5px; padding: 8px; font-size: 15px; border-radius: 8px; border: 1px solid #ccc; }
    button { cursor: pointer; background-color: #0078ff; color: white; border: none; }
    button:hover { background-color: #005fcc; }
    img.icon { width: 40px; height: 40px; border-radius: 8px; }
  </style>
</head>
<body>
  <div id="controls">
    <input type="text" id="keyword" placeholder="ê²€ìƒ‰ì–´ ì…ë ¥ (ì˜ˆ: ì œì£¼ ì¹´í˜)" />
    <select id="category">
      <option value="accommodation">í˜¸í…”</option>
      <option value="tourism">ê´€ê´‘ì§€</option>
      <option value="cafe">ì¹´í˜</option>
      <option value="restaurant">ìŒì‹ì </option>
    </select>
    <button onclick="searchPlaces()">ê²€ìƒ‰</button>
    <select id="history" onchange="loadHistory(this.value)">
      <option value="">ğŸ“œ ìµœê·¼ ê²€ìƒ‰</option>
    </select>
    <button onclick="clearHistory()">ğŸ—‘ ì „ì²´ì‚­ì œ</button>
  </div>

  <div id="map"></div>

  <script>
    const map = L.map("map").setView([33.389, 126.53], 10);
    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
      maxZoom: 19,
    }).addTo(map);

    // ì¹´í…Œê³ ë¦¬ë³„ ì•„ì´ì½˜ ì´ë¯¸ì§€
    const icons = {
      accommodation: L.icon({ iconUrl: "https://cdn-icons-png.flaticon.com/512/139/139899.png", iconSize: [40, 40] }),
      cafe: L.icon({ iconUrl: "https://cdn-icons-png.flaticon.com/512/2950/2950731.png", iconSize: [40, 40] }),
      restaurant: L.icon({ iconUrl: "https://cdn-icons-png.flaticon.com/512/1046/1046784.png", iconSize: [40, 40] }),
      tourism: L.icon({ iconUrl: "https://cdn-icons-png.flaticon.com/512/684/684908.png", iconSize: [40, 40] }),
      shop: L.icon({ iconUrl: "https://cdn-icons-png.flaticon.com/512/2331/2331970.png", iconSize: [40, 40] }),
      service: L.icon({ iconUrl: "https://cdn-icons-png.flaticon.com/512/3135/3135715.png", iconSize: [40, 40] }),
      etc: L.icon({ iconUrl: "https://cdn-icons-png.flaticon.com/512/2910/2910768.png", iconSize: [40, 40] }),
    };

    let markers = [];

    function searchPlaces() {
      const keyword = document.getElementById("keyword").value.trim();
      const category = document.getElementById("category").value;
      if (!keyword) {
        alert("ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”!");
        return;
      }

      const apiUrl = `https://api.geoapify.com/v2/places?categories=${category}&filter=countrycode:kr&name=${encodeURIComponent(keyword)}&limit=20&apiKey=YOUR_API_KEY`;

      fetch(apiUrl)
        .then((res) => res.json())
        .then((data) => {
          clearMarkers();
          if (data.features.length === 0) {
            alert("ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.");
            return;
          }

          data.features.forEach((p) => {
            const cat = p.properties.categories ? p.properties.categories[0] : "";
            let displayCat = "";
            if (cat.includes("accommodation")) displayCat = "í˜¸í…”";
            else if (cat.includes("tourism")) displayCat = "ê´€ê´‘ì§€";
            else if (cat.includes("cafe")) displayCat = "ì¹´í˜";
            else if (cat.includes("restaurant")) displayCat = "ìŒì‹ì ";
            else if (cat.includes("shop")) displayCat = "ìƒì ";
            else if (cat.includes("service")) displayCat = "ì„œë¹„ìŠ¤";
            else displayCat = "ê¸°íƒ€";

            const icon =
              cat.includes("accommodation") ? icons.accommodation :
              cat.includes("tourism") ? icons.tourism :
              cat.includes("cafe") ? icons.cafe :
              cat.includes("restaurant") ? icons.restaurant :
              cat.includes("shop") ? icons.shop :
              cat.includes("service") ? icons.service :
              icons.etc;

            const marker = L.marker([p.geometry.coordinates[1], p.geometry.coordinates[0]], { icon }).addTo(map);
            marker.bindPopup(`<b>[${displayCat}] ${p.properties.name}</b><br>${p.properties.address_line2 || ""}`);
            markers.push(marker);
          });

          saveHistory(keyword);
          updateHistoryUI();
          map.setView([data.features[0].geometry.coordinates[1], data.features[0].geometry.coordinates[0]], 13);
        })
        .catch((err) => console.error(err));
    }

    function clearMarkers() {
      markers.forEach((m) => map.removeLayer(m));
      markers = [];
    }

    function saveHistory(keyword) {
      let history = JSON.parse(localStorage.getItem("searchHistory") || "[]");
      if (!history.includes(keyword)) {
        history.unshift(keyword);
        if (history.length > 10) history.pop();
        localStorage.setItem("searchHistory", JSON.stringify(history));
      }
    }

    function updateHistoryUI() {
      const select = document.getElementById("history");
      select.innerHTML = '<option value="">ğŸ“œ ìµœê·¼ ê²€ìƒ‰</option>';
      const history = JSON.parse(localStorage.getItem("searchHistory") || "[]");
      history.forEach((h) => {
        const option = document.createElement("option");
        option.value = h;
        option.textContent = h;
        select.appendChild(option);
      });
    }

    function loadHistory(value) {
      if (value) {
        document.getElementById("keyword").value = value;
        searchPlaces();
      }
    }

    function clearHistory() {
      localStorage.removeItem("searchHistory");
      updateHistoryUI();
      alert("ìµœê·¼ ê²€ìƒ‰ ê¸°ë¡ì´ ëª¨ë‘ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
    }

    updateHistoryUI();
  </script>
</body>
</html>
